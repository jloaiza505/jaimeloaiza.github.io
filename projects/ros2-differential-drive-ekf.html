<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ROS2 - Differential-Drive Simulation with EKF State Estimation | Jaime Loaiza</title>
    <link rel="icon" href="../assets/images/shared/icon.png">
    <link rel="stylesheet" href="../css/styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Project details page: ROS2 - Differential-Drive Simulation with EKF State Estimation | Jaime Loaiza">
    <link rel="canonical" href="https://jaimeloaiza.github.io/projects/ros2-differential-drive-ekf.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="ROS2 - Differential-Drive Simulation with EKF State Estimation | Jaime Loaiza">
    <meta property="og:description" content="Project details page: ROS2 - Differential-Drive Simulation with EKF State Estimation | Jaime Loaiza">
    <meta property="og:url" content="https://jaimeloaiza.github.io/projects/ros2-differential-drive-ekf.html">
    <meta property="og:image" content="https://jaimeloaiza.github.io/assets/images/shared/icon.png">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="ROS2 - Differential-Drive Simulation with EKF State Estimation | Jaime Loaiza">
    <meta name="twitter:description" content="Project details page: ROS2 - Differential-Drive Simulation with EKF State Estimation | Jaime Loaiza">
    <meta name="twitter:image" content="https://jaimeloaiza.github.io/assets/images/shared/icon.png">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=IBM+Plex+Serif:wght@400;500&display=swap" rel="stylesheet">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R24RTV018F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-R24RTV018F');
    </script>
</head>
<body>

<div class="page">
    <nav class="nav">
        <a href="../index.html" class="nav-logo"><img src="../assets/images/shared/icon.png" alt="Home"></a>
        <div class="nav-links">
            <a href="../index.html">Home</a>
            <a href="../projects.html">All Projects</a>
        </div>
    </nav>

    <header class="project-hero">
        <div class="hero-banner banner-landscape" style="--hero-image: url('../assets/images/ros2-differential-drive-ekf/banner.png');"></div>
        <div class="hero-inner">
            <div class="reveal" data-delay="1">
                <h1>ROS2 - Differential-Drive Simulation with EKF State Estimation</h1>
                <p class="subtitle">Robotics &amp; Control</p>
                <div class="hero-card">
                    ROS 2 simulation pipeline that compares noisy wheel odometry against EKF-filtered state estimates using reproducible metrics.
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <section class="reveal" data-delay="2">
            <h2>Problem Statement</h2>
            <p>
                This project studies how noisy wheel odometry can be improved with filtering in a ROS 2 simulation. The system publishes
                ground truth, noisy wheel odometry, and IMU data, then runs an EKF to produce filtered odometry and path topics.
                The objective is measurable behavior under noise, not perfect localization.
            </p>
        </section>

        <section class="reveal" data-delay="3">
            <h2>System Architecture</h2>
            <p>
                Runtime flow is split between a simulator and estimator package. <code>robot_sim_node</code> publishes
                <code>/ground_truth/odom</code>, <code>/wheel/odom</code>, <code>/imu/data</code>, and TF <code>odom -&gt; base_link</code>.
                <code>ekf_node</code> subscribes to wheel odometry plus IMU yaw and publishes <code>/ekf/odom</code> along with
                <code>/wheel/path</code>, <code>/ekf/path</code>, and <code>/ground_truth/path</code>. RViz visualization is launched via
                <code>phase1.launch.py</code>.
            </p>
            <div class="card-media project-media">
                <img src="../assets/images/ros2-differential-drive-ekf/arch_node_graph.png" alt="Architecture node and topic graph">
                <p class="media-caption">Autogenerated caption: node and topic graph for simulation and EKF runtime flow.</p>
            </div>
        </section>

        <section class="reveal" data-delay="3">
            <h2>Technical Implementation</h2>
            <p>
                The workspace is organized as a ROS 2 source tree under <code>src/</code>: <code>robot_sim_pkg</code> for simulation,
                <code>state_estimator_pkg</code> for EKF and metrics logging, and <code>bringup_pkg</code> as a minimal baseline package.
                The plotting script <code>tools/plot_metrics.py</code> converts CSV logs into metrics figures.
            </p>
            <h3>Software Stack</h3>
            <ul>
                <li>ROS 2 Jazzy</li>
                <li>Python ROS packages: <code>rclpy</code>, <code>nav_msgs</code>, <code>geometry_msgs</code>, <code>sensor_msgs</code>, <code>tf2_ros</code></li>
                <li><code>launch</code> and <code>launch_ros</code></li>
                <li>RViz2</li>
                <li><code>numpy</code> and <code>matplotlib</code></li>
            </ul>
            <h3>Core Engineering Decisions</h3>
            <ul>
                <li>Separated simulator and estimator packages to isolate responsibilities.</li>
                <li>Used wheel odometry for EKF prediction and IMU yaw for correction.</li>
                <li>Exposed noise and EKF tuning values as launch arguments in <code>phase1.launch.py</code>.</li>
                <li>Saved metrics to <code>metrics/ekf_metrics.csv</code> for repeatable comparisons and plotting.</li>
                <li>Kept CI/build commands aligned to <code>colcon build/test --base-paths src</code>.</li>
            </ul>
        </section>

        <section class="reveal" data-delay="4">
            <h2>Key Challenges &amp; Solutions</h2>
            <ul>
                <li>Metrics files were easy to lose in <code>/tmp</code>; moved default output to <code>metrics/ekf_metrics.csv</code> in the repository.</li>
                <li>Filter behavior was hard to inspect from logs; expanded plotting to include RMSE, yaw RMSE, drift, and reductions.</li>
                <li>Project layout was inconsistent with deployment templates; migrated to root <code>src/</code> and template-style metadata/CI files.</li>
            </ul>
        </section>

        <section class="reveal" data-delay="4">
            <h2>Results</h2>
            <div class="card-media project-media">
                <img src="../assets/images/ros2-differential-drive-ekf/main_results.png" alt="Primary EKF metrics result plot">
                <p class="media-caption">Autogenerated caption: primary metrics figure comparing raw and EKF-filtered behavior.</p>
            </div>
            <p>
                In the current tuning setup, yaw RMSE is clearly reduced by the EKF while position RMSE reduction is small but positive.
                Drift reduction varies over time with both positive and negative windows, consistent with limited absolute-position correction.
            </p>
            <div class="card-media project-media">
                <img src="../assets/images/ros2-differential-drive-ekf/ekf_rviz_paths.png" alt="RViz paths for ground truth, raw, and EKF trajectories">
                <p class="media-caption">Autogenerated caption: RViz path comparison for ground truth, wheel odometry, and EKF output.</p>
            </div>
            <div class="card-media project-media">
                <img src="../assets/images/ros2-differential-drive-ekf/topics_check_terminal.png" alt="Terminal checks for active ROS 2 topics">
                <p class="media-caption">Autogenerated caption: terminal validation of key topics during EKF runtime.</p>
            </div>
            <h3>Demo</h3>
            <div class="card-media project-media">
                <img src="../assets/images/ros2-differential-drive-ekf/demo_ekf_run.gif" alt="Simulation and EKF demo run">
                <p class="media-caption">Autogenerated caption: end-to-end simulation and EKF behavior demo.</p>
            </div>
        </section>

        <section class="reveal" data-delay="5">
            <h2>Reproducibility</h2>
            <p>From the repository root:</p>
            <pre><code>source /opt/ros/jazzy/setup.bash
colcon build --base-paths src
source install/setup.bash
ros2 launch robot_sim_pkg phase1.launch.py</code></pre>
            <p>Run with explicit noise and filter parameters:</p>
            <pre><code>ros2 launch robot_sim_pkg phase1.launch.py \
  left_wheel_noise_std:=0.18 right_wheel_noise_std:=0.18 \
  imu_yaw_noise_std:=0.08 imu_wz_noise_std:=0.04 \
  r_imu_yaw:=0.20 q_yaw:=0.02 \
  metrics_csv_path:=metrics/ekf_metrics.csv random_seed:=7</code></pre>
            <p>Generate plots from CSV:</p>
            <pre><code>python3 tools/plot_metrics.py metrics/ekf_metrics.csv --out metrics/ekf_metrics_all.png</code></pre>
            <p>Key files: <code>src/robot_sim_pkg/launch/phase1.launch.py</code>, <code>src/robot_sim_pkg/robot_sim_pkg/robot_sim_node.py</code>, <code>src/state_estimator_pkg/state_estimator_pkg/ekf_node.py</code>, <code>src/robot_sim_pkg/rviz/phase1.rviz</code>, <code>tools/plot_metrics.py</code>, <code>.github/workflows/ci.yml</code>.</p>
            <div class="card-media project-media">
                <img src="../assets/images/ros2-differential-drive-ekf/repro_build_steps.png" alt="Reproducibility build and run commands">
                <p class="media-caption">Autogenerated caption: reference build and launch command workflow.</p>
            </div>
            <p><a class="github-btn" href="https://github.com/jloaiza505/ros2-differential-drive-ekf" target="_blank" rel="noopener">GITHUB REPO</a></p>
        </section>

        <section class="reveal" data-delay="5">
            <h2>What I Would Improve</h2>
            <ul>
                <li>Add at least one absolute position measurement source to strengthen position correction analysis.</li>
                <li>Add automated EKF behavior tests with expected RMSE reduction bounds.</li>
                <li>Store experiment metadata (parameter sets and seeds) with each CSV output.</li>
                <li>Add multi-seed launch workflows and summary statistics.</li>
                <li>Expand and version architecture and RViz screenshots for richer documentation evidence.</li>
            </ul>
        </section>
    </div>

    <footer>
        &copy; 2026 Jaime Loaiza
    </footer>
</div>

<script src="../js/code-blocks.js"></script>

<script src="../js/nav-mobile.js"></script>

</body>
</html>
